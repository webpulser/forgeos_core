<%
  output = {
    :iTotalDisplayRecords => @users.total_entries || 0,
    :aaData => @users.collect do |user|
      link_id = "user_#{user.id}"
      klass = user.active? ? 'see-on' : 'see-off'
      table =
      [
      content_tag(:div, content_tag(:div, '', :class=>'handler') + content_tag(:div, '', :class => 'small-icons user-ico'), :id => link_id, :class => 'handler_container'),
      content_tag(:div, (params[:mode] == 'selection' ? user.fullname : link_to(user.fullname, [:admin, user])), :class => 'user-name'),
      content_tag(:div, (params[:mode] == 'selection' ? user.email : mail_to(user.email, user.email, :class => 'truncate', :title => user.email)), :class => 'email'),
      ]

      unless params[:mode] == 'selection'
        table <<
        link_to('', :url => activate_admin_user_path(user),
          :remote => true,
          :complete => "toggleActivate('#show_#{link_id}')",
          :html => {
            :class => "small-icons #{klass}",
            :id => "show_#{link_id}"
         }
        ) <<
        link_to('', [:edit, :admin, user], :class => 'small-icons edit-link') +
        link_to('', :url => [:admin, user],
          :remote => true,
          :method => :delete,
          :confirm => I18n.t('user.destroy.confirm').capitalize,
          :success => "removedataTablesRow('#destroy_#{link_id}')",
          :html => {
            :class => 'small-icons destroy-link', :id => "destroy_#{link_id}"
        })
      else
        table << user.id
      end
      table
    end
}
-%>
<%= output.to_json -%>
